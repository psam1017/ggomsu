<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Config 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="Article">
	<select id="getTotal" resultType="_int">
		SELECT COUNT(`index`) FROM psam1017.articles
	</select>
	
	<select id="getArticleList" parameterType="_int" resultType="article">
		SELECT @rownum := @rownum + 1 AS R, A.`index`, A.title, A.memberNickname, A.viewCount, A.writtenAt
		FROM psam1017.articles A, (SELECT @rownum := 0) rownum
		LIMIT 10 OFFSET #{page}
	</select>
	
	<select id="getBestArticleList" parameterType="_int" resultType="article">
		SELECT A.`index`, A.title, A.memberNickname , A.writtenAt, A.viewCount, B.articleLikeCount 
		FROM psam1017.articles AS A 
		LEFT OUTER JOIN (SELECT COUNT(1) AS articleLikeCount, articleIndex FROM articleLike GROUP BY articleIndex) AS B
		ON A.`index` = B.articleIndex
		ORDER BY articleLikeCount DESC
		LIMIT 10 OFFSET #{page};
	</select>
	
	<select id="getSearchTotal" parameterType="string" resultType="_int">
	SELECT COUNT(`index`)
	FROM (
	SELECT A.`index`
	FROM psam1017.articles A
	WHERE CONCAT(A.title, A.memberNickname, A.content) LIKE #{search}) AS SL ;
	</select>
	
	<select id="getSearchArticleList" parameterType="string" resultType="article">
		SELECT A.`index`, A.title, A.memberNickname, A.viewCount, A.writtenAt, B.articleLikeCount
		FROM psam1017.articles A
		LEFT OUTER JOIN (SELECT COUNT(1) AS articleLikeCount, articleIndex FROM articleLike GROUP BY articleIndex) AS B
		ON A.`index` = B.articleIndex
		WHERE CONCAT(A.title, A.memberNickname, A.content) LIKE #{search};
	</select>
	
	<select id="getArticle" parameterType="_int" resultType="article">
		SELECT A.`index`, A.boardValue, A.title, A.memberNickname , A.writtenAt, A.viewCount, A.content, AL.articleLikeCount 
		FROM psam1017.articles AS A 
		LEFT OUTER JOIN (SELECT COUNT(1) AS articleLikeCount, articleIndex FROM articleLike GROUP BY articleIndex) AS AL
		ON A.`index` = AL.articleIndex
		WHERE A.`index` = #{index};
	</select>
	
</mapper>